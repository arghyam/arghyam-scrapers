<!DOCTYPE html><html lang="en">
<head>
  <title>Arghyam scrapers</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <style>
    body { padding-top: 60px; }
    .controls { display: none; }
    #menu { font-size: 125%; line-height: 1.25; color: #c0504d; }
  </style>
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
</head><body>

<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">TSC</a>
      <ul class="nav">
        <!-- li><a href="#">About</a></li -->
      </ul>
    </div>
  </div>
</div>

<div class="container">
  <h2 id="menu"></h2>
  <h1 id="title"></h1>
  <svg class="treemap" width="100%" height="500"></svg>
  <p id="story"></p>
  <p><a target="_blank" href="http://tsc.gov.in/" id="source">Source</a></p>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/underscore-min.js"></script>
<script src="js/d3.v2.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="stories.js"></script>
<script>
var svg = d3.select('svg.treemap');

var menu = d3.nest().key(function(d) { return d.menu; }).entries(stories);
var parentmenu = d3.select('ul.nav')
  .selectAll('li.dropdown')
    .data(menu)
  .enter()
    .append('li')
    .classed('dropdown', true);

parentmenu
  .append('a')
  .attr('href', '#')
  .classed('dropdown-toggle', true)
  .attr('data-toggle', 'dropdown')
  .text(function(d) { return d.key + ' '; })
      .append('b')
      .classed('caret', true);

parentmenu
  .append('ul')
  .classed('dropdown-menu', true)
  .selectAll('li')
      .data(function(d) { return d.values; })
    .enter()
      .append('li')
        .append('a')
        .attr('href', '#')
        .text(function(d) { return d.title; })
        .on('click', draw)

function draw(story) {
  // Set the title and story
  d3.select('#menu').text(story.menu);
  d3.select('#title').text(story.title);
  d3.select('#story').text(story.story);
  d3.select('#source').attr('href', story.url);

  // Filter the data
  d3.csv(story.file, function(data) {
    var subset = _.filter(data, story.filter);

    var treemap = d3.layout.treemap()
      .size([parseInt(svg.style('width')), svg.attr('height')])
      .sticky(true)
      .children(function(d) { return d.values; })
      .value(story.size);

    var nodes = d3.nest();
    story.group.forEach(function(group) {
      nodes = nodes.key(function(d) { return d[group]})
    });

    treemap.nodes({
      'key': 'India',
      'values': nodes.entries(subset)
    });

    var node = svg.selectAll('rect')
      .data(treemap.nodes)
      .call(position)
      .attr('fill', story.color)
    node.select('title')
      .text(story.hover);
    node.enter().append('rect')
      .call(position)
      .attr('fill', story.color)
      .append('title')
        .text(story.hover);
    node.exit().remove();
  });
}

function position() {
  this.transition()
    .duration(400)
    .attr('x', function(d) { return d.x; })
    .attr('y', function(d) { return d.y; })
    .attr('width', function(d) { return d.dx; })
    .attr('height', function(d) { return d.dy; })
    .attr('stroke', '#fff')
}

</script>
</body></html>
